import { useState, useEffect } from 'react'
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs/blocks'

import { Attachment, Autocomplete, Flex, Typography } from '../components'
import { ThemeProvider } from '../theme'

import { useDebounce } from '@naveteam/prometheus'

<Meta title='Data Input/Autocomplete' component={Autocomplete} />

# Autocomplete

O autocomplete tem a finalidade de facilitar a seleção de opções através de um `textField` e filtros baseados no valor desse `textField`

<Canvas>
  <Story
    name='Default'
    parameters={{
      design: {
        type: 'figma',
        url: 'https://www.figma.com/file/O3bKxIcsj2rc1FNIRclJyT/Saturn-System?node-id=300%3A1'
      }
    }}
  >
    <ThemeProvider>
      <Autocomplete
        onChange={(value) => alert(`Você selecionou a opção com id: ${value}`)}
        options={[
          {name: 'Pelotas', id: 1},
          {name: 'Arroio Grande', id: 2},
          {name: 'São Paulo', id: 3},
          {name: 'Rio de Janeiro', id: 4}
        ]}
        getOptionValue={(option) => option.id}
        getOptionLabel={(option) => option.name}
        label='Básico'
      />
    </ThemeProvider>
  </Story>
</Canvas>

# Autocomplete com erro

Passando a prop de `error` para o `Autocomplete` atrelada a prop `message`, o usuário pode receber um feedback visível que existe algum ponto a ser alterado no input em questão.

<Canvas>
  <Story
    name='Error'
    parameters={{
      design: {
        type: 'figma',
        url: 'https://www.figma.com/file/O3bKxIcsj2rc1FNIRclJyT/Saturn-System?node-id=300%3A1'
      }
    }}
  >
    <ThemeProvider>
      <Autocomplete
        onChange={(value) => alert(`Você selecionou a opção com id: ${value}`)}
        options={[
          {name: 'Pelotas', id: 1},
          {name: 'Arroio Grande', id: 2},
          {name: 'São Paulo', id: 3},
          {name: 'Rio de Janeiro', id: 4}
        ]}
        getOptionValue={(option) => option.id}
        getOptionLabel={(option) => option.name}
        label='Básico'
        error
        message='error message'
      />
    </ThemeProvider>
  </Story>
</Canvas>

# Autocomplete assincrono

A variante `upload` pode acompanhar ícones à sua esquerda a depender do estado. O usuário pode efetuar duas ações: visualizar ou excluir o arquivo. Existe também a possibilidade de estes ícones serem substituídos por um loader.

<Canvas>
  <Story
    name='Upload'
    parameters={{
      design: {
        type: 'figma',
        url: 'https://www.figma.com/file/O3bKxIcsj2rc1FNIRclJyT/Saturn-System?node-id=300%3A1'
      }
    }}
  >
    {() => {
      const [loading, setLoading] = useState(true)
      const [typed, setTyped] = useState('')
      const [options, setOptions] = useState([])
      const debouncedTyped = useDebounce(typed)
      useEffect(() => {
        setLoading(true)
        fetch("https://country.register.gov.uk/records.json?page-size=5000")
          .then(res => res.json())
          .then(
            (countries) => {
              setLoading(false);
              setOptions(Object.keys(countries).map((key) => countries[key].item[0]))
            },
            (error) => {
              setLoading(false);
              setError(error);
            }
          )
      }, [debouncedTyped])
      useEffect(() => {
        setLoading(true)
      }, [typed])
      return <ThemeProvider><Autocomplete loading={loading} onChange={() => console.log('oi')} onChangeText={(e) => setTyped(e)} options={options} getOptionValue={(e) => e.country} getOptionLabel={(e) => e.name} label='teste' /></ThemeProvider>
    }}
  </Story>
</Canvas>

<ArgsTable of={Attachment} />
